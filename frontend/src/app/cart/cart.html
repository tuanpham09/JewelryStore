<app-header [showBackButton]="true" [backButtonText]="'Quay lại'" [cartItemCount]="cartItems.length"></app-header>

<!-- Breadcrumb -->
<div class="breadcrumb">
    <span (click)="goBack()" style="cursor: pointer;">Home</span>
    <mat-icon>chevron_right</mat-icon>
    <span class="current">Giỏ hàng</span>
</div>

<!-- Cart Content -->
<div class="cart-container">
    <!-- Cart Header -->
    <div class="cart-header">
        <h1 class="cart-title">Giỏ hàng của bạn</h1>
        <p class="cart-subtitle" *ngIf="cartItems.length > 0">
            Bạn có {{ cartItems.length }} sản phẩm trong giỏ hàng
        </p>
    </div>

    <!-- Empty Cart -->
    <div class="empty-cart" *ngIf="cartItems.length === 0">
        <div class="empty-cart-content">
            <mat-icon class="empty-cart-icon">shopping_cart</mat-icon>
            <h2>Giỏ hàng trống</h2>
            <p>Bạn chưa có sản phẩm nào trong giỏ hàng. Hãy khám phá các sản phẩm tuyệt vời của chúng tôi!</p>
            <button mat-raised-button color="primary" class="continue-shopping-btn" (click)="continueShopping()">
                <mat-icon>shopping_bag</mat-icon>
                Tiếp tục mua sắm
            </button>
        </div>
    </div>

    <!-- Cart Items -->
    <div class="cart-content" *ngIf="cartItems.length > 0">
        <div class="cart-items-section">
            <!-- Select All -->
            <div class="select-all-section">
                <mat-checkbox [(ngModel)]="allSelected" (change)="toggleSelectAll()" class="select-all-checkbox">
                    Chọn tất cả ({{ selectedItems.length }}/{{ getSelectableItemsCount() }})
                </mat-checkbox>
                <button mat-button class="clear-selected-btn" (click)="removeSelectedItems()"
                    *ngIf="selectedItems.length > 0">
                    <mat-icon>delete</mat-icon>
                    Xóa đã chọn
                </button>
            </div>

            <!-- Cart Items List -->
            <div class="cart-items-list">
                <div class="cart-item" *ngFor="let item of cartItems" [class.out-of-stock]="!item.inStock">
                    <!-- Item Checkbox -->
                    <div class="item-checkbox">
                        <mat-checkbox [(ngModel)]="item.selected" (change)="toggleSelectItem(item)"
                            [disabled]="!item.inStock">
                        </mat-checkbox>
                    </div>

                    <!-- Item Image -->
                    <div class="item-image" (click)="navigateToProduct(item.productId)">
                        <img [src]="item.image" [alt]="item.name" />
                        <div class="out-of-stock-overlay" *ngIf="!item.inStock">
                            <span>Hết hàng</span>
                        </div>
                    </div>

                    <!-- Item Info -->
                    <div class="item-info">
                        <h3 class="item-name" (click)="navigateToProduct(item.productId)">{{ item.name }}</h3>
                        <div class="item-options" *ngIf="item.size || item.color">
                            <mat-chip *ngIf="item.size" class="option-chip">Size: {{ item.size }}</mat-chip>
                            <mat-chip *ngIf="item.color" class="option-chip">Màu: {{ item.color }}</mat-chip>
                        </div>
                        <div class="item-price">
                            <span class="current-price">{{ item.price | currency:'VND':'symbol':'1.0-0' }}</span>
                            <span class="original-price" *ngIf="item.originalPrice">
                                {{ item.originalPrice | currency:'VND':'symbol':'1.0-0' }}
                            </span>
                        </div>
                    </div>

                    <!-- Quantity Controls -->
                    <div class="quantity-section">
                        <div class="quantity-controls" *ngIf="item.inStock">
                            <button mat-icon-button (click)="decreaseQuantity(item)" [disabled]="item.quantity <= 1">
                                <mat-icon>remove</mat-icon>
                            </button>
                            <span class="quantity-display">{{ item.quantity }}</span>
                            <button mat-icon-button (click)="increaseQuantity(item)"
                                [disabled]="item.quantity >= item.stockQuantity">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                        <div class="stock-info" *ngIf="item.inStock">
                            Còn {{ item.stockQuantity }} sản phẩm
                        </div>
                        <div class="out-of-stock-info" *ngIf="!item.inStock">
                            <mat-icon>warning</mat-icon>
                            <span>Hết hàng</span>
                        </div>
                    </div>

                    <!-- Item Total -->
                    <div class="item-total">
                        <span class="total-price">{{ (item.price * item.quantity) | currency:'VND':'symbol':'1.0-0'
                            }}</span>
                        <span class="original-total" *ngIf="item.originalPrice">
                            {{ (item.originalPrice * item.quantity) | currency:'VND':'symbol':'1.0-0' }}
                        </span>
                    </div>

                    <!-- Remove Button -->
                    <div class="remove-section">
                        <button mat-icon-button class="remove-btn" (click)="removeItem(item)">
                            <mat-icon>delete_outline</mat-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Summary -->
        <div class="cart-summary">
            <mat-card class="summary-card">
                <mat-card-header>
                    <mat-card-title>Tóm tắt đơn hàng</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div class="summary-row">
                        <span>Tạm tính ({{ getTotalItems() }} sản phẩm):</span>
                        <span>{{ getSubtotal() | currency:'VND':'symbol':'1.0-0' }}</span>
                    </div>
                    <div class="summary-row" *ngIf="getDiscount() > 0">
                        <span>Giảm giá:</span>
                        <span class="discount">-{{ getDiscount() | currency:'VND':'symbol':'1.0-0' }}</span>
                    </div>
                    <div class="summary-row">
                        <span>Phí vận chuyển:</span>
                        <span [class.free-shipping]="getShipping() === 0">
                            {{ getShipping() === 0 ? 'Miễn phí' : (getShipping() | currency:'VND':'symbol':'1.0-0') }}
                        </span>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="summary-row total-row">
                        <span>Tổng cộng:</span>
                        <span class="total-amount">{{ getTotal() | currency:'VND':'symbol':'1.0-0' }}</span>
                    </div>
                    <div class="shipping-note" *ngIf="getSubtotal() < 1000000">
                        <mat-icon>local_shipping</mat-icon>
                        <span>Mua thêm {{ (1000000 - getSubtotal()) | currency:'VND':'symbol':'1.0-0' }} để được miễn
                            phí vận chuyển</span>
                    </div>
                </mat-card-content>
                <mat-card-actions>
                    <button mat-raised-button color="primary" class="checkout-btn" (click)="proceedToCheckout()"
                        [disabled]="selectedItems.length === 0">
                        <mat-icon>payment</mat-icon>
                        Thanh toán ({{ selectedItems.length }} sản phẩm)
                    </button>
                    <button mat-button class="continue-shopping-btn" (click)="continueShopping()">
                        <mat-icon>shopping_bag</mat-icon>
                        Tiếp tục mua sắm
                    </button>
                </mat-card-actions>
            </mat-card>

            <!-- Security Features -->
            <div class="security-features">
                <h3>Mua sắm an toàn</h3>
                <div class="security-items">
                    <div class="security-item">
                        <mat-icon>security</mat-icon>
                        <span>Bảo mật thông tin</span>
                    </div>
                    <div class="security-item">
                        <mat-icon>local_shipping</mat-icon>
                        <span>Giao hàng nhanh</span>
                    </div>
                    <div class="security-item">
                        <mat-icon>undo</mat-icon>
                        <span>Đổi trả dễ dàng</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<app-footer></app-footer>